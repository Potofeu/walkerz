<div class="container pale-background py-3">
  <div class="row-fluid">

    <div class="card-show" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(<%= cl_image_path @hike.locations.first.photo.key %>)">
        <h1 id="top"><%= @hike.name %></h1>
    </div>
    <div class="card-show-actions">
          <div class="card-txt">
            <h6>Distance</h6>
            <p><%= @hike.distance %></p>
          </div>
          <div class="card-txt">
            <h6>Durée</h6>
              <p><%= @hike.time %></p>
          </div>
          <div class="card-txt">
            <h6>Note</h6>
            <p>
              <i class="fas fa-star"></i> <%= @average %>
            </p>
          </div>
          <div class="card-txt">
            <h6 data-controller="weather">Metéo</h6>
            <p>
              <i class="fa-solid fa-cloud"></i>
            </p>
          </div>
    </div>
    <div class="row-fluid">
        <p class="mt-4"><%= @hike.description %></p>
        <div class="row-gap-3">
          <select class="form-select" aria-label="Choisissez une étape">
            <option selected>Sélectionnez une étape</option>
            <% @points.each do |point| %>
             <option value="<%= point.step %>" data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom<%= point.step %>">Etape <%= point.step %></option>
            <% end %>
          </select>
           <% @points.each do |point| %>
	            <%= render 'offcanvas_etape', point: point %>
          <% end %>
        </div>
        <div class="map-show mt-2" style="width: 100%; height:350px;"
          data-controller="map"
          data-map-markers-value="<%= @markers.to_json %>"
          data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
        </div>
    </div>
  </div>
  <div class="row justify-content-evenly mb-5">
    <div class="col-8 text-center">
      <% if @hike.reviews.count <= 1 %>
        <h2 class="text-center">(<%= @hike.reviews.count%>) Commentaire</h2>
      <% else %>
        <h2 class="text-center">(<%= @hike.reviews.count%>) Commentaires</h2>
      <% end %>
    </div>
    <div class="col-4 text-center">
      <%= link_to hike_path(anchor: 'form'), class: "btn btn-blue" do %>
        <i class="fa-sharp fa-solid fa-download"></i> Ajouter
      <% end %>
    </div>
    <hr>
    <div class="col-12">
      <% @hike.reviews.each do |review| %>
        <div class="comment py-1">
          <div class="d-flex justify-content-between">
            <div class="col-6 text-left">
              <% review.rating.times do %>
                <i class="fas fa-star"></i>
              <% end %>
            </div>
            <div class="col-6 text-right">
              <p id="date">Le: <%= review.created_at.strftime("%d-%m-%Y") %></p>
            </div>
          </div>
          <p id="content"><%= review.content %></p>
          <div class="d-flex justify-content-between">
            <div class="col-6 text-center">
              <p><%= review.user.first_name %></p>
            </div>
            <div class="col-6 text-center">
              <% if review.user == current_user %>
                <%= link_to review_path(review), data: { turbo_method: :delete, turbo_confirm: "Etes-vous sûr de supprimer votre commentaire?"} do %>
                  <i class="fa-sharp fa-solid fa-circle-xmark"></i> Supprimer
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <hr>
      <% end %>
      <div class="d-flex justify-content-center">
        <div class="col-10">
          <h3 class="text-center">Ajouter un commentaire</h3>
          <%= simple_form_for [@hike, @review] do |f| %>
            <%= f.input :content, label: "Commentaire" %>
            <%= f.input :rating, as: :select, collection: (1..5), required: true, label: "Donnez une note" %>
          <%= f.submit "Ajouter", class:"btn btn-orange" %>
        <% end %>
          <div id="form" class="my-1">
            <%= link_to "Revenir tout en haut", hike_path(anchor: 'top'), class: "btn btn-blue" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
